function globalErrorHandler(t,e,i,n,r){var s=n?"\ncolumn: "+n+!r?"":"\nerror: "+r:"";$("#dvMessage").text("javascript error: "+t+"\nurl: "+e+"\nline: "+i+s),$("#btnClearMessage").show();return!0}function setCookie(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var r="expires="+n.toUTCString();document.cookie=t+"="+e+"; "+r}function getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return""}var app=angular.module("appBibleContents",["ngRoute"]);app.run(["serviceApiCalls","$rootScope",function(t,e){e.bibleStructures=null,t.getBibleStructure(),e.typeOf=function(t){return typeof t}}]),app.factory("$exceptionHandler",function(){return function(t,e){$("#dvMessage").html("Angular error: "+decodeURI(t.message)+" :"+e+"<br/>"+t.fileName.substring(t.fileName.lastIndexOf("/"))+" :"+t.lineNumber),$("#btnClearMessage").show()}}),app.service("serviceDisplay",function(){var t=this;this.publish=[],this.arDisplayData=[],this.currentIndex=1,this.titlePrefix="",this.registerSubscriber=function(e){t.publish.push(e)},this.setDisplayData=function(e,i,n){t.currentIndex=i,t.titlePrefix=n,t.arDisplayData=e,t.publish.forEach(function(t){t("dataChange")})},this.startDisplay=function(e){t.currentIndex=e,t.publish.forEach(function(t){t("switchTab")})}}),app.controller("controllerDisplay",["serviceDisplay","serviceBibleSettings",function(t,e){var i=this;this.publish=[],this.arDisplayData=[],this.selectedDisplay=[],this.titlePrefix="",this.step=2,this.currentIndex=1,this.fromIndex=1,this.toIndex=this.fromIndex+this.step,this.init=function(){t.registerSubscriber(i.updateDisplaySubscriber),e.registerSubscriber(i.updateSettingsSubscriber)},this.updateDisplaySubscriber=function(e){null!=e&&"dataChange"==e&&(i.arDisplayData=t.arDisplayData,i.currentIndex=t.currentIndex,i.titlePrefix=t.titlePrefix,i.setDisplayRange("start",i.currentIndex)),null!=e&&"switchTab"==e&&(i.currentIndex=t.currentIndex,i.setDisplayRange("start",i.currentIndex),$('#menuTabs a[href= "#divDisplay"]').tab("show"))},this.updateSettingsSubscriber=function(){var t=e.settings.versesPerPage;i.step!=t&&(i.step=parseInt(t),i.setDisplayRange("start",i.currentIndex))},this.setStartDisplay=function(t){i.currentIndex=t,i.setDisplayRange("start",i.currentIndex)},this.setDisplayRange=function(t,e){var n=1,r=i.arDisplayData.length,s=e?parseInt(e):n;"next"==t&&(s=i.currentIndex+i.step),"back"==t&&(s=i.currentIndex-i.step),s=n>s?n:s,s=s>r?r:s,i.currentIndex=s,i.fromIndex=s,i.toIndex=s+i.step-1,i.toIndex>r&&(i.toIndex=r),i.selectedDisplay=[];for(var u=i.fromIndex-1;u<=i.toIndex-1;u++)i.selectedDisplay.push(i.arDisplayData[u])},this.currentTitle=function(){return i.fromIndex==i.toIndex?i.titlePrefix+" : "+i.fromIndex:i.titlePrefix+" : "+i.fromIndex+" - "+i.toIndex},this.init()}]),app.service("serviceApiCalls",["$http","$rootScope",function(t,e){var i="http://churchhelper.azurewebsites.net/apiBible/",n=this;this.getBibleStructure=function(){t.get(i+"GetBibleStructure").then(function(t){var i=t.data;i.Status.Ok?(e.bibleStructures=i.Data,e.bibleStructures.unshift(i.Data[0])):n.failureApiCall(i)},this.failureHttpRequest)},this.getVerseOfChapter=function(e,r,s,u){t.get(i+"GetVersesOfChapter/"+e+"/"+r+"/"+s).then(function(t){var e=t.data;e.Status.Ok?u(e.Data):n.failureApiCall(e)},this.failureHttpRequest)},this.doSearch=function(e,r){t.post(i+"DoSearch",e).then(function(t){var e=t.data;e.Status.Ok?r(e.Data,e.Pagination):n.failureApiCall(e)},this.failureHttpRequest)},this.failureHttpRequest=function(t){$("#dvMessage").text("http Failure: "+t.status+" : "+t.statusText),$("#btnClearMessage").show()},this.failureApiCall=function(t){$("#dvMessage").text("api Failure: "+t.Status.Id+" : "+t.Status.Info),$("#btnClearMessage").show()}}]),app.controller("controllerBibleContents",["serviceApiCalls","serviceBibleSettings","serviceDisplay","$rootScope","$scope",function(t,e,i,n,r){var s=this;this.bibleStructure={},this.books=[],this.chapters=[],this.verses=[],s.current={bibleId:0,book:{Id:0,Name:"",ChapterCount:1},chapter:1,verse:1,fromVerse:1,toVerse:1};var u=null;this.init=function(){e.registerSubscriber(s.updateSubscriber),u=r.$watch(function(){return n.bibleStructures},function(){null!=n.bibleStructures&&(s.getBibleStructure(n.bibleStructures[0]),s.setBook(s.books[0],!1),u())},!0)},this.updateSubscriber=function(){var t=e.settings.bibleId;s.current.bibleId!=t&&(s.current.bibleId=t,null!=n.bibleStructures&&null!=n.bibleStructures[s.current.bibleId]&&(s.getBibleStructure(n.bibleStructures[s.current.bibleId]),s.setBook(s.current.book,!0)))},this.getBibleStructure=function(t){s.bibleStructure=t,s.current.bibleId=s.bibleStructure.Id,this.books=[],s.bibleStructure.Testments.forEach(function(t){t.Groups.forEach(function(t){t.Books.forEach(function(t){t.boolSelected=!1,s.books.push(t)})})})},this.getBookById=function(t){var e={};return s.books.forEach(function(i){i.Id==t&&(e=i)}),e},this.clickBook=function(t){s.setBook(t,!1)},this.setBook=function(t,e){if(e)s.current.book=s.getBookById(t.Id),s.setChapter(s.current.chapter,s.current.verse);else if(s.current.book.Id!=t.Id){s.current.book=t,s.chapters=[];for(var i=1;i<=t.ChapterCount;i++)s.chapters.push(i);s.setChapter(s.chapters[0],1)}},this.clickChapter=function(t){s.setChapter(t,1)},this.setChapter=function(e,i){s.current.chapter=e,s.current.verse=i,t.getVerseOfChapter(s.current.bibleId,s.current.book.Id,s.current.chapter,s.getVersesOfChapter)},this.clickVerse=function(t){s.current.verse=t.VerseNo,i.startDisplay(s.current.verse)},this.getVersesOfChapter=function(t){s.verses=t;var e=[];s.verses.forEach(function(t){e.push({label:t.VerseNo,text:t.VerseText})}),i.setDisplayData(e,s.current.verse,s.currentTitle())},this.currentTitle=function(){var t=s.current.book.Name+" "+s.current.chapter;return t},r.$on("goContext",function(t,e){s.current.book=s.getBookById(e.bookId),s.setChapter(e.chapterId,e.verseNo),i.startDisplay(s.current.verse)}),this.init()}]),app.controller("controllerSearch",["serviceApiCalls","serviceBibleSettings","serviceDisplay","$rootScope","$scope",function(t,e,i,n,r){var s=this;this.bibleStructure={},this.currentBibleId=1,this.searchTerm="",this.searchResult=[],this.searchOptions=[{id:1,name:"term",caption:"must exact match"},{id:2,name:"prefix",caption:"must start with"},{id:3,name:"wildcard",caption:"must contain"},{id:4,name:"fuzzy",caption:"should look like"},{id:5,name:"mustnot",caption:"must not contain"}],this.selectedSearchOption=this.searchOptions[0],this.pagination={};var u=null;this.init=function(){e.registerSubscriber(s.updateSubscriber),u=r.$watch(function(){return n.bibleStructures},function(){null!=n.bibleStructures&&(s.bibleStructure=n.bibleStructures[0],u())},!0)},this.updateSubscriber=function(){s.currentBibleId=parseInt(e.settings.bibleId),null!=n.bibleStructures&&null!=n.bibleStructures[s.currentBibleId]&&(s.bibleStructure=n.bibleStructures[s.currentBibleId])},this.clickBible=function(){s.bibleStructure.Selected=1==s.bibleStructure.Selected?0:1,s.bibleStructure.Testments.forEach(function(t){s.clickTestment(t,s.bibleStructure.Selected)})},this.clickTestment=function(t,e){t.Selected=null==e?1==t.Selected?0:1:e,t.Groups.forEach(function(e){s.clickGroup(e,t.Selected)})},this.clickGroup=function(t,e){t.Selected=null==e?1==t.Selected?0:1:e,t.Books.forEach(function(e){e.Selected=t.Selected,e.boolSelected=1==t.Selected?!0:!1})},this.clickBook=function(t){t.Selected=t.boolSelected?1:0},this.showGroup=function(t){var e=[];return null!=s.bibleStructure.Testments&&"undefined"!=s.bibleStructure.Testments&&s.bibleStructure.Testments.forEach(function(i){i.Groups.forEach(function(i){var n=!1;n=n||1==t&&(1==i.Id||2==i.Id||3==i.Id),n=n||2==t&&(4==i.Id||5==i.Id),n=n||3==t&&(6==i.Id||7==i.Id||8==i.Id),n=n||4==t&&(9==i.Id||10==i.Id),n&&e.push(i)})}),e},this.getBookName=function(t){var e=parseInt(t),i="";return s.bibleStructure.Testments.forEach(function(t){t.Groups.forEach(function(t){t.Books.forEach(function(t){parseInt(t.Id)==e&&(i=t.Name.trim())})})}),i},this.doSearch=function(e){if("."==e||".."==e);else{var i={pageIndex:e,bibleIds:[s.currentBibleId],bibleFilter:s.bibleStructure,searchCriteria:{searchItems:[{searchTerm:s.searchTerm}]}},n=angular.toJson(i);t.doSearch(n,s.successDoSearch)}},this.successDoSearch=function(t,e){s.searchResult=t,s.pagination=e;var n=[];s.searchResult.forEach(function(t){n.push({label:s.getBookName(t.BookId)+" "+t.ChapterId+" : "+t.VerseNo,text:t.VerseText})}),i.setDisplayData(n,1,"Result Page : "+s.pagination.CurrentPage)},this.startDisplay=function(t){i.startDisplay(t)},this.goContext=function(t,e,i){n.$broadcast("goContext",{bookId:t,chapterId:e,verseNo:i})},this.getTranslations=function(t,e,i,n){alert("getTranslations: "+t+e+i+n)},this.sendToService=function(t,e,i,n){alert("sendToService: "+t+e+i+n)},this.getPagination=function(){for(var t=[],e=s.pagination.TotalPageCount>20,i=!1,n=1;n<=s.pagination.TotalPageCount;n++)e&&n>4&&n<=s.pagination.TotalPageCount-4?i||(t.push(".."),i=!0):t.push(n);return t},this.init()}]),app.service("serviceStyleSettings",["serviceBibleSettings",function(t){var e=this;this.publish=[],this.settings={backgroundColor:"aliceblue",backgroundImage:"none",fontColor:"black",fontSize:"18",align:"left",language:"english"},this.getSettings=function(){return e.settings},this.registerSubscriber=function(t){e.publish.push(t)},this.initSettings=function(){var i=getCookie("styleSettings");null!=i&&""!=i&&(e.settings=JSON.parse(i)),e.settings.align=t.settings.align,e.settings.language=t.settings.language,e.publish.forEach(function(t){t()})},this.saveSettings=function(){setCookie("styleSettings",JSON.stringify(e.settings),1e3)},this.init=function(){t.registerSubscriber(e.updateSubscriber)},this.updateSubscriber=function(){e.settings.align=t.settings.align,e.settings.language=t.settings.language,e.publish.forEach(function(t){t()})},this.setFontSize=function(t){e.settings.fontSize=t,e.publish.forEach(function(t){t()})},this.setBackgroundColor=function(t){e.settings.backgroundColor=t,e.publish.forEach(function(t){t()})},this.setFontColor=function(t){e.settings.fontColor=t,e.publish.forEach(function(t){t()})},this.displayStyle=function(){var t={};return t["background-color"]=e.settings.backgroundColor,t.color=e.settings.fontColor,t["font-size"]=e.settings.fontSize+"px",t["text-align"]=e.settings.align,t.height="100%",t},this.init()}]),app.controller("controllerStyles",["serviceStyleSettings",function(t){var e=this;this.settings={},this.visibleContentLeft=!0,this.visibleContentRight=!1,this.init=function(){t.registerSubscriber(e.updateSubscriber),t.initSettings()},this.updateSubscriber=function(){e.settings=t.getSettings(),e.visibleContentLeft="left"==t.settings.align,e.visibleContentRight="right"==t.settings.align},this.clickSaveSettings=function(){t.saveSettings()},this.setFontSize=function(){t.setFontSize(e.settings.fontSize)},this.setBackgroundColor=function(){t.setBackgroundColor(e.settings.backgroundColor)},this.setFontColor=function(){t.setFontColor(e.settings.fontColor)},this.displayStyle=function(){return t.displayStyle()},this.init()}]),app.service("serviceBibleSettings",["$rootScope",function(t){var e=this;this.publish=[],this.settings={versesPerPage:2,bibleId:1,align:"right",language:"arabic"},this.getSettings=function(){return e.settings},this.registerSubscriber=function(t){e.publish.push(t)},this.initSettings=function(){var t=getCookie("bibleSettings");null!=t&&""!=t&&(e.settings=JSON.parse(t)),e.publish.forEach(function(t){t()})},this.saveSettings=function(){setCookie("bibleSettings",JSON.stringify(e.settings),1e3)},this.setVersesPerPage=function(t){e.settings.versesPerPage=t,e.publish.forEach(function(t){t()})},this.setBibleId=function(i){e.settings.bibleId=i;var n=parseInt(i);null!=t.bibleStructures&&null!=t.bibleStructures[n]&&(e.settings.align=t.bibleStructures[n].Alignment,e.settings.language=t.bibleStructures[n].Language),e.publish.forEach(function(t){t()})}}]),app.controller("controllerBibleSettings",["serviceBibleSettings","$scope",function(t,e){var i=this;this.settings={},this.bibles=[{id:1,name:"Van-Dyke"},{id:2,name:"KJV"}],this.init=function(){t.registerSubscriber(i.updateSubscriber),t.initSettings()},this.updateSubscriber=function(){i.settings=t.getSettings()},this.clickSaveSettings=function(){t.saveSettings()},this.setBibleId=function(e){t.setBibleId(e)},this.setVersesPerPage=function(){t.setVersesPerPage(i.settings.versesPerPage)},this.init()}]),app.directive("stringToNumber",function(){return{require:"ngModel",link:function(t,e,i,n){n.$parsers.push(function(t){return""+t}),n.$formatters.push(function(t){return parseFloat(t,10)})}}}),app.controller("controllerGeneral",function(){this.range=function(t,e,i){for(var n=[],r=t;e>=r;r+=i)n.push(r);return n},this.cloneObject=function(t){var e=JSON.parse(JSON.stringify(t));return e}});